name: /pub/medical/laboratory/4tvc-microlab/v6
desc: The latest version Microlab by Four Thieves Vinegar Collective.
cover:
  assembly: microlab

docs:
  intro: |
    This is a [PartCAD](https://partcad.org/) package for MicroLab.
    It is intended to maintain the information about all the parts
    for the following purposes: manufacturing, procurement and assembly
    (both manual and automated assembly instructions).

    *DISCLAIMER: PartCAD is still under heavy development, and so is
    the PartCAD package for Microlab. Please, consider contributing to
    both PartCAD and this package, but do not yet use this package
    for manufacturing or ordering Microlab parts.*

{% from 'urls.j2' import url_prefix %}
{% set url = url_prefix + '/v6' %}

sketches:
  m26:
    type: basic
    circle: 13 # 13 mm radius equals to 26 mm diameter
  m74:
    type: basic
    circle: 37 # 37 mm radius equals to 74 mm diameter
  ring-5-3:
    desc: Ring with 5 mm outer radius and 3 mm inner radius
    type: basic
    circle: 5
    inner:
      circle: 3
  
interfaces:
  m74:
    desc: Abstract 74 mm circular interface
    abstract: True
    ports:
      m74:
        location: [[0, 0, 0], [0, 0, 1], 0] # redandant, for demonstration
        sketch: m74
    parameters:
      turnZ:
        min: 0
        max: 360
        default: 0
      moveX: {}  # Hotizontal offset for openings of different sizes
      moveY: {}  # Hotizontal offset for openings of different sizes
      moveZ: {}  # Offset along the alignment axis  m74-jar-mouth:
  m74-opening:
    desc: Abstract 74 mm circular opening
    inherits:
      m74: opening
  m74-jar-mouth:
    desc: Jar mouth (inner opening) with 74 mm diameter
    inherits: 
      m74-opening: jar-mouth
  m74-shaft:
    desc: Abstract 74 mm shaft
    inherits:
      m74: shaft
    mates:
      - m74-opening
  m74-jar-closing:
    inherits: 
      m74-shaft: jar-closing
    mates:
      - m74-jar-mouth  

parts:
  # Control Unit
  control-box:
    desc: Regular size control box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/control-box-v.1.1.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[3, 3, 75], [1, 0, 0], 180]
        outer-right: [[205, 3, 75], [1, 0, 0], 180]
        inner-left: [[3, 3, 69.5], [1, 0, 0], 0]
        inner right: [[205, 3, 69.5], [1, 0, 0], 0]
    ports:
      rpi: [[8, 36, 51], [-0.71, -0.71, 0], 180]
      uno: [[131.5, 39.5, 8], [0.71, 0.71, 0], 180]
  control-box-lid:
    desc: Control box lid for regular size control box
    type: step
    fileFrom: url
    # TODO(clairbee): Update the fileUrl to the correct file once it is fixed
    fileUrl: {{ url }}/control-box/control-box-lid-v.1.0.step
    # fileUrl: {{ url }}/control-box/control-box-lid-flat-v.1.0.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[-101, -47, 4], [1, 0, 0], 180]
        outer-right: [[101, -47, 4], [1, 0, 0], 180]
        inner-left: [[-101, -47, 0], [1, 0, 0], 0]
        inner-right: [[101, -47, 0], [1, 0, 0], 0]
  control-box-flat:
    desc: Low profile control box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/control-box-flat-v.1.0.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[3, 3, 44], [1, 0, 0], 180]
        outer-right: [[185, 3, 44], [1, 0, 0], 180]
        inner-left: [[3, 3, 33], [1, 0, 0], 0]
        inner-right: [[185, 3, 33], [1, 0, 0], 0]
    ports:
      rpi: [[8, 22.5, 20], [-0.71, -0.71, 0], 180]
      uno: [[179.5, 92, 8], [0, 1, 0], 180]
  control-box-lid-flat:
    desc: Control box lid for low profile control box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/control-box-lid-flat-v.1.0.step
    implements:
      "/pub/std/metric/m:m3-thru":
        outer-left: [[-91, -89, 4], [1, 0, 0], 180]
        outer-right: [[91, -89, 4], [1, 0, 0], 180]
        inner-left: [[-91, -89, 0], [1, 0, 0], 0]
        inner-right: [[91, -89, 0], [1, 0, 0], 0]
  relay-case-no-top:
    desc: Relay board case without a top cover
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/sub-components/relay-board-case-50x73x17mm-no-top.step
  relay-case:
    desc: Relay board case with a top cover
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/sub-components/relay-case-50x73x17mm.step
  stepdown-case:
    desc: A case fir 12V-to-5V stepdown converter
    type: step
    fileFrom: url
    fileUrl: {{ url }}/control-box/sub-components/stepdown-case-63x27x14mm.step
  
  # -------- Reactor Unit --------

  # Pumps box
  pumps-box:
    desc: Pumps box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/pumps-box-v.1.0-rotated.step
    implements:
      "/pub/std/metric/m:m3-thru":
        upper-left: [[5, 64, 183], [1, 0, 0], 90]
        # TODO: commented out as not used so far, but may be needed later, or deleted
        # upper-right: [[183, 64, 183], [1, 0, 0], 90]
        # lower-left: [[5, 64, 5], [1, 0, 0], 90]
        # lower-right: [[183, 64, 5], [1, 0, 0], 90]
        pump-x-upper-left: [[12.5, 0, 179], [1, 0, 0], -90]
        pump-y-upper-left: [[75, 0, 179], [1, 0, 0], -90]
        pump-z-upper-left: [[137.5, 0, 179], [1, 0, 0], -90]
      # TODO: simplification here, concrete mounting to be elaborated
      "/pub/std/metric/m:m24-thru":
        heat-pump-opening: [[4, 19, 64], [0, 1, 0], 90]
        cool-pump-opening: [[184, 19, 64], [0, 1, 0], -90]        
  pumps-box-lid:
    desc: Lid for pumps box
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/pumps-box-lid-v0.3-rotated.step
    implements:
      "/pub/std/metric/m:m3-thru":
        upper-left-back: [[5, 4, 183], [1, 0, 0], 90]
        upper-right-back: [[183, 4, 183], [1, 0, 0], 90]
        lower-left-back: [[5, 4, 5], [1, 0, 0], 90]
        lower-right-back: [[183, 4, 5], [1, 0, 0], 90]
        upper-left-front: [[5, 0, 183], [1, 0, 0], -90]
        # TODO: commented out as not used so far, but may be needed later, or deleted
        # upper-right-front: [[183, 0, 183], [1, 0, 0], -90]
        # lower-left-front: [[5, 0, 5], [1, 0, 0], -90]
        # lower-right-front: [[183, 0, 5], [1, 0, 0], -90]
  peristaltic-pump:
    desc: Peristaltic pump (model Intllab DP-520-48S)
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/peristaltic-pump.step
    implements:        
      "/pub/std/metric/m:m3-thru":
        upper-left-back: [[-26.75, 20.5, 18.75], [1, 0, 0], 90]
        upper-right-back: [[27.25, 20.5, 18.75], [1, 0, 0], 90]
        lower-left-back: [[-26.75, 20.5, -18.75], [1, 0, 0], 90]
        lower-right-back: [[27.25, 20.5, -18.75], [1, 0, 0], 90]
        upper-left-front: [[-26.75, 15.5, 18.75], [1, 0, 0], -90]
        upper-right-front: [[27.25, 15.5, 18.75], [1, 0, 0], -90]
        lower-left-front: [[-26.75, 15.5, -18.75], [1, 0, 0], -90]
        lower-right-front: [[27.25, 15.5, -18.75], [1, 0, 0], -90]
  circulation-pump:
    desc: Circulation pump (https://www.amazon.com/dp/B09XH1GYYQ)
    type: step
    fileFrom: url
    fileUrl: {{ url }}/pumps-box/circulation-pump.step
    implements:
      # TODO: describe proper mounting
      "/pub/std/metric/m:m24-shaft":
        mount: [[0, 0, 52], [1, 0, 0], 0]

  # Reactor stand
  stand-part-h:
    desc: Reactor stand "H" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-H.v1.0-rotated.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-thru":
        eye-back-upper: [[13, 175, 134], [1, 1, 0], 180]
        eye-back-lower: [[13, 175, 10], [1, 1, 0], 180]
        eye-front-1: [[13, 10, 151.5], [1, 1, 0], 180]
        eye-front-2: [[13, 38.5, 151.5], [1, 1, 0], 180]
  stand-part-a:
    desc: Reactor stand "A" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-A.v1.0.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-shaft":
        hook-left-upper: [[57, 9, 54], [0, 0, 1], 180]
        hook-left-lower: [[57, 9, -70], [0, 0, 1], 180]
        hook-right-upper: [[-113.5, 9, -44], [0, 0, 1], 0]
        hook-right-lower: [[-113.5, 9, -70], [0, 0, 1], 0]
  stand-part-c:
    desc: Reactor stand "Â¢" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-c.v1.0.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-shaft":
        hook-back-right: [[-113.5, 145.5, 72], [0, 0, 1], 180]
        hook-front-right: [[-113.5, 174, 72], [0, 0, 1], 180]
        hook-back-left: [[57, 145.5, 72], [0, 0, 1], 180]
        hook-front-left: [[57, 174, 72], [0, 0, 1], 180]
  stand-part-k:
    desc: Reactor stand "k" part
    type: step
    fileFrom: url
    fileUrl: {{ url }}/reactor-stand/reactor-stand-k.v1.0.step
    implements:
      # TODO: there might be more fitting interface
      "/pub/std/metric/m:m10-thru":
        eye-back-upper: [[-113.5, 9, -44], [1, 1, 0], 180]
        eye-back-lower: [[-113.5, 9, -70], [1, 1, 0], 180]
        eye-front-1: [[-113.5, 145.5, 71.5], [1, 1, 0], 180]
        eye-front-2: [[-113.5, 174, 71.5], [1, 1, 0], 180]

  # Temperature Exchange Units
  cold-unit-jar:
    desc: Jar for cooling unit
    type: cadquery
    path: parts/mason-jar-32oz-wide-mouth.py
    implements:
      "m74-jar-mouth":
        mouth: [[0, 0, 165], [1, 0, 0], 180]
  cold-unit-jar-band:
    desc: Jar band for cooling unit
    type: cadquery
    path: parts/mason-jar-band-wide-mouth.py
  cold-unit-lid:
    desc: Lid for cooling unit
    type: step
    fileFrom: url
    fileUrl: {{ url }}/temperature-units/cold-unit-lid-v.1.0.step
    implements:
      "/pub/std/metric/m:m10-thru":
        left-outer: [[-24, 0, 0], [1, 0, 0], 0]
        right-outer: [[24, 0, 0], [1, 0, 0], 0]
      "m74-jar-closing":
        bottom: [[0, 0, 4], [1, 0, 0], 180]
  # TODO: uncomment and use when sweep is generally available
  # cold-unit-tube:
    # desc: Spiral tube for cooling unit
    # type: sweep
    # sketch: ring-5-3
    # axis: [[0, 0, 20], [0, 0, 20], [20, 0, 0], [20, 20, 0], [0, 20, 0]]  
  hot-unit-lid:
    desc: Lid for heating unit
    type: step
    fileFrom: url
    fileUrl: {{ url }}/temperature-units/hot-unit-lid-v.1.0.step

assemblies:
  microlab:
    type: assy
    path: microlab.assy
  control-unit:
    type: assy
    path: control-unit.assy
    parameters:
      profile:
        type: string
        desc: Profile of the control box
        enum: [regular, flat]
        default: flat
      screw_type:
        type: string
        desc: Type of the screws attaching lid to the control box
        enum: [raisedcountersunkovalhead-iso7047, raisedcheesehead-iso7045]
        default: raisedcountersunkovalhead-iso7047
    render:
      svg:
        viewportOrigin: [75, 0, 150]
  reactor-unit-pumps-box:
    type: assy
    path: reactor-unit-pumps-box.assy
    parameters:
      screw_type:
        type: string
        desc: Type of the screws attaching lid to the control box
        enum: [raisedcountersunkovalhead-iso7047, raisedcheesehead-iso7045]
        default: raisedcountersunkovalhead-iso7047
  reactor-unit-reactor-stand:
    type: assy
    path: reactor-unit-reactor-stand.assy
  heating-unit:
    type: assy
    path: heating-unit.assy
  cooling-unit:
    type: assy
    path: cooling-unit.assy

render:
  svg:
    lineWeight: 1.5
  readme:
